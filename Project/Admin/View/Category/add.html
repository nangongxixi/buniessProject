<!--图片上传-->
<link rel="stylesheet" href="{$smarty.const.STATIC_URL}upImage/zyupload/skins/zyupload-1.0.0.min.css " type="text/css">
<script type="text/javascript" src="{$smarty.const.STATIC_URL}upImage/zyupload/zyupload.basic-1.0.0.min.js"></script>

<div class="col-xs-12">
    <div class="box">
        <div class="box-body">
            <form method="post" enctype="multipart/form-data" id="formData">
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <th class="detail-title">分类名称</th>
                        <td>
                            <div>
                                <input type="hidden" name="id" class="form-control"
                                       value="{$categoryDetail.category_id}">
                                <input type="text" name="category_name" class="form-control"
                                       value="{$categoryDetail.category_name}"
                                       errorMsg="分类名称不能为空"
                                       placeholder="请填写分类名称">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th class="detail-title">分类父级</th>
                        <td>
                            <div>
                                <select class="form-control" name="category_pid">
                                    <option value="">—— 请选择 ——</option>
                                   <!-- {html_options options=$categoryinfo}-->
                                        {foreach $categoryinfo as $k=>$v}
                                        <option value="{$k}" {if $k== $parentDetail.category_id}selected="selected" {/if}>{$v}</option>
                                        {/foreach}
                                </select>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th class="detail-title">排序</th>
                        <td>
                            <div>
                                <input type="text" name="category_sort" class="form-control" value="{$categoryDetail.category_sort}"
                                       placeholder="请填写排序">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: center">
                            <button type="reset" class="btn bg-orange btn-lg " status="0">重置
                            </button>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <button type="button" id="submit" class="btn btn-success btn-lg subform">提交</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </form>
        </div>
    </div>
</div>


<script>
    $(function () {

        init();//初始化


        //提交表单
        $('#submit').unbind('click').click(function () {

            //数据验证
            if (!validata()) {
                return false;
            }

            //判断是否有选择上传文件
            var formData = new FormData($("#formData")[0]);
            $.ajax({
                url: '../category/add',
                type: 'POST',
                data: formData,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function (returnJSON) {
                    if (returnJSON.status) {
                        layer.msg(returnJSON.msg, {
                            icon: 1,
                            time: 2000
                        }, function () {
                            sessionStorage.clear();
                            localStorage.setItem('address', '../category/showlist');//保存当前地址,避免刷新跳转
                            $('#content').load('../category/showlist');
                        });
                    } else {
                        layer.msg(returnJSON.msg, {
                            icon: 2,
                            time: 2000
                        });
                    }
                }
            });
        });

        //数据验证
        function validata() {
            var formVal = $('form input,textarea');

            //标题
            if ($(formVal[1]).val() == '') {
                layer.msg($(formVal[1]).attr("errorMsg"), {
                    icon: 2,
                    time: 2000
                });
                return false;
            }
            return true;

        }

        //初始化需要运行的东西
        function init() {
            var inputVal = JSON.parse(sessionStorage.getItem("inputVal"));
            //如果还没保存过输入，就定义一个空对象来保存
            if (inputVal == null) {
                var inputVal = {};
            }
            //回填输入
            $.each(inputVal, function (index, item) {
                $(document).find('input[name="' + index + '"],textarea[name="' + index + '"]').val(item);
            });
            //保存输入
            $('form input,textarea').keyup(function () {
                var name = $(this).attr('name');
                var val = $(this).val();
                inputVal[name] = val;
                sessionStorage.setItem('inputVal', JSON.stringify(inputVal));
            });
        }

    });
</script>
